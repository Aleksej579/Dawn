{{ '0-collection-subscribe.out.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }} {
    padding-top: {{ section.settings.padding_top_mobile }}px;
    padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }
  @media (min-width: 750px) {
    .section-{{ section.id }} {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  .collection-subscribe {
     background: linear-gradient({{ section.settings.direction }}, {{ section.settings.color_1 }} 0%, {{ section.settings.color_2 }} 70.71%);

    & .__container {
      background: none;
    }
  }
{%- endstyle -%}

<div class="collection-subscribe__wrapper section-{{ section.id }} page-width color-{{ section.settings.color_scheme }}">
  <div class="cs__container">
    {%- for block in section.blocks -%}
      {% case block.type %}
        {% when 'title' %}
          <h2 class="cs__title">{{ block.settings.title }}</h2>
        {% when 'subtitle' %}
          <p class="cs__subtitle">{{ block.settings.subtitle }}</p>
        {% when 'subscribe' %}
          {% form 'customer', id: 'subscribe-cs' %}
            <input
              type="email"
              name="contact[email]"
              placeholder="Enter your email address"
              class="email-input"
              required
            >
            <button type="submit" class="btn-subscribe">
              <span class="btn-text">Subscribe now</span>
              <span class="btn-loading" style="display: none;">Sending...</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                class="btn-icon"
              >
                <path d="M15.566 0.175119C15.8816 0.393869 16.0472 0.771994 15.9878 1.15012L13.9878 14.1501C13.941 14.4532 13.7566 14.7189 13.4878 14.8689C13.2191 15.0189 12.8972 15.0376 12.6128 14.9189L8.87533 13.3657L6.7347 15.6814C6.45658 15.9845 6.01908 16.0845 5.6347 15.9345C5.25033 15.7845 5.00033 15.4126 5.00033 15.0001V12.3876C5.00033 12.2626 5.0472 12.1439 5.13158 12.0532L10.3691 6.33762C10.5503 6.14074 10.5441 5.83762 10.3566 5.65012C10.1691 5.46262 9.86595 5.45012 9.66908 5.62824L3.31283 11.2751L0.553451 9.89387C0.222201 9.72824 0.00970049 9.39699 0.000325486 9.02824C-0.00904951 8.65949 0.184701 8.31574 0.503451 8.13137L14.5035 0.131369C14.8378 -0.0592555 15.2503 -0.0405055 15.566 0.175119Z" fill="currentColor"/>
              </svg>
            </button>
            {{ form.errors | default_errors }}
          {% endform %}
        {% when 'benefits' %}
          <div class="cs__benefits">
            {% for i in (1..3) %}
              {% assign text_benefits = 'text_benefits_' | append: i %}
              <article>
                {%- if block.settings.svg_code != blank -%}
                  {{ block.settings.svg_code }}
                {%- endif -%}
                <span>{{ block.settings[text_benefits] }}</span>
              </article>
            {% endfor %}
          </div>
      {% endcase %}
    {%- endfor -%}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const subscribeForm = document.querySelector('#subscribe-cs');
    const emailInput = subscribeForm?.querySelector('input[type="email"]');
    const submitBtn = subscribeForm?.querySelector('.btn-subscribe');
    const btnText = submitBtn?.querySelector('.btn-text');
    const btnLoading = submitBtn?.querySelector('.btn-loading');
    const btnIcon = submitBtn?.querySelector('.btn-icon');

    if (subscribeForm) {
      subscribeForm.addEventListener('submit', function (e) {
        e.preventDefault();

        if (emailInput.value.trim() === '') {
          return;
        }

        if (submitBtn && btnText && btnLoading && btnIcon) {
          submitBtn.disabled = true;
          btnText.style.display = 'none';
          btnLoading.style.display = 'inline';
          btnIcon.style.display = 'none';
        }

        const subscribePopupWrap = document.createElement('div');
        subscribePopupWrap.classList.add('subscribe-popup__wrap');
        subscribePopupWrap.innerHTML = `
            <p>
              <svg width="64px" height="64px" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill="#137829" d="M9 0a9 9 0 1 0 9 9 9 9 0 0 0-9-9zm4.49 6.924l-5.02 5.51a.983.983 0 0 1-1.442 0l-2.48-2.482a.983.983 0 0 1 .008-1.417 1.027 1.027 0 0 1 1.4.02L7.712 10.3l4.3-4.73a1.018 1.018 0 0 1 1.4-.075 1.006 1.006 0 0 1 .078 1.43z"></path> </g></svg>
              <span>You successfully completed the form</span>
            </p>
        `;
        document.body.appendChild(subscribePopupWrap);

        // Удаляем попап через 5 секунд
        setTimeout(function () {
          subscribePopupWrap.remove();

          // Восстанавливаем состояние кнопки
          if (submitBtn && btnText && btnLoading && btnIcon) {
            submitBtn.disabled = false;
            btnText.style.display = 'inline';
            btnLoading.style.display = 'none';
            btnIcon.style.display = 'inline';
          }

          // Очищаем поле ввода
          emailInput.value = '';

          // Отправляем форму (Shopify сделает это автоматически после таймаута)
          setTimeout(() => {
            subscribeForm.submit();
          }, 100);
        }, 5000);
      });
    }
  });
</script>

{% schema %}
{
  "name": "Collection subscribe",
  "class": "collection-subscribe",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "default": "scheme_1",
      "label": "Color Scheme"
    },
    {
      "type": "header",
      "content": "Gradient BG"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "options": [
        { "value": "0deg", "label": "↑ Up" },
        { "value": "45deg", "label": "↗ Up-Right" },
        { "value": "90deg", "label": "→ Right" },
        { "value": "135deg", "label": "↘ Down-Right" },
        { "value": "180deg", "label": "↓ Down" },
        { "value": "225deg", "label": "↙ Down-Left" },
        { "value": "270deg", "label": "← Left" },
        { "value": "315deg", "label": "↖ Up-Left" }
      ],
      "default": "135deg"
    },
    {
      "type": "color",
      "id": "color_1",
      "label": "Color 1",
      "default": "#131313"
    },
    {
      "type": "color",
      "id": "color_2",
      "label": "Color 2",
      "default": "#3C3C38"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    },
    {
      "type": "header",
      "content": "Mobile section padding"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    }
  ],
  "max_blocks": 4,
  "blocks": [
    {
      "type": "title",
      "name": "Title",
      "settings": [
        {
          "type": "richtext",
          "id": "title",
          "label": "Title"
        }
      ]
    },
    {
      "type": "subtitle",
      "name": "Subtitle",
      "settings": [
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "Text subtitle"
        }
      ]
    },
    {
      "type": "subscribe",
      "name": "Subscribe",
      "settings": []
    },
    {
      "type": "benefits",
      "name": "Benefits",
      "settings": [
        {
          "type": "textarea",
          "id": "svg_code",
          "label": "SVG Code",
          "info": "Insert the code for your SVG icon",
          "default": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\" fill=\"none\">\n<path d=\"M9 18C11.3869 18 13.6761 17.0518 15.364 15.364C17.0518 13.6761 18 11.3869 18 9C18 6.61305 17.0518 4.32387 15.364 2.63604C13.6761 0.948212 11.3869 0 9 0C6.61305 0 4.32387 0.948212 2.63604 2.63604C0.948212 4.32387 0 6.61305 0 9C0 11.3869 0.948212 13.6761 2.63604 15.364C4.32387 17.0518 6.61305 18 9 18ZM12.9727 7.34766L8.47266 11.8477C8.14219 12.1781 7.60781 12.1781 7.28086 11.8477L5.03086 9.59766C4.70039 9.26719 4.70039 8.73281 5.03086 8.40586C5.36133 8.07891 5.8957 8.07539 6.22266 8.40586L7.875 10.0582L11.7773 6.15234C12.1078 5.82188 12.6422 5.82188 12.9691 6.15234C13.2961 6.48281 13.2996 7.01719 12.9691 7.34414L12.9727 7.34766Z\" fill=\"#FEE301\"/>\n</svg>"
        },
        {
          "type": "text",
          "id": "text_benefits_1",
          "label": "Text for benefits 1",
          "default": "Text benefits"
        },
        {
          "type": "text",
          "id": "text_benefits_2",
          "label": "Text for benefits 2",
          "default": "Text benefits"
        },
        {
          "type": "text",
          "id": "text_benefits_3",
          "label": "Text for benefits 3",
          "default": "Text benefits"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection subscribe",
      "category": "Custom"
    }
  ]
}
{% endschema %}
